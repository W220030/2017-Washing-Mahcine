C51 COMPILER V8.05a   TEX                                                                  05/13/2013 19:21:38 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE TEX
OBJECT MODULE PLACED IN Tex.OBJ
COMPILER INVOKED BY: C:\Program Files\C51\BIN\C51.EXE Tex.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg51.h>
   2          //****************************//
   3          #define uchar unsigned char
   4          #define uint unsigned int
   5          
   6          
   7          //***************************//
   8          sbit mo_r = P3^2;         //电机右控制线
   9          sbit mo_l = P3^3;               //电机左控制线
  10          
  11          //****************************//
  12          sbit key_menu = P3^4; // 菜单按键
  13          sbit key_on = P3^5;       // 开始按键
  14          sbit key_off = P3^6; //  结束按键
  15          sbit key_se = P3^7;      //      菜单选择按键
  16          
  17          //***************************//
  18          sbit led_in = P0^0;             //      进水指示灯
  19          sbit led_xi = P0^1;        //  洗衣指示灯
  20          sbit led_pao = P0^2;    //      泡洗指示灯
  21          sbit led_xx = P0^3;        //  脱水指示灯
  22          sbit led_out = P0^4;  //   出水指示灯
  23          sbit led_over = P0^5;  // 洗衣结束指示灯
  24          sbit led_work = P0^6;  // 电机工作指示灯
  25          sbit led_wring = P0^7;   //     报警指示灯
  26          
  27          sbit other = P3^1;       //      脱水盖子保护开关
  28          sbit anther = P3^0;      //     洗衣电源控制开关
  29          
  30          //******************************//
  31          uchar code num[10]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  32                                                                             //
  33          //*****************************//
  34          char sec = 0;             //  时间秒
  35          char min = 0;              // 时间分
  36          uchar count=0;            //  中断计数
  37          uchar flag0=0;            //  洗衣机工作状态标志
  38          uchar flag1=0;            //  进水次数标志
  39          uchar flag2=0;            //  出水次数标志
  40          uchar flag3=0;           //       泡洗次数标志
  41          uchar err =0;      //   报警标志
  42          uchar quan = 0;//正反转计数  
  43          //**********************************//
  44          //       函数声明
  45          //*************************************//
  46          void delay();// 延时函数
  47          void in();      //        进水子程序
  48          void out();      //       出水子程序
  49          void over();  //  结束子程序
  50          void xi();       //       洗衣子程序
  51          void pao();     //       泡衣子程序
  52          void xx(); //   脱水子程序
  53          void on(); //  工作on处理子程序
  54          void se(); //  显示菜单选择
  55          void SEG_display();      //显示时间子程序
C51 COMPILER V8.05a   TEX                                                                  05/13/2013 19:21:38 PAGE 2   

  56          void key_scan();   //  按键扫描子程序
  57          
  58          //*****************************//
  59          //     延时函数
  60          //****************************//
  61          void delay(uint i)
  62          {
  63   1              uint x,y;
  64   1              for(x=i;x>0;x--)
  65   1               for(y=50;y>0;y--);
  66   1      }
  67          
  68          //******************************//
  69          //         工作on处理子程序
  70          //********************************//
  71          void on()
  72          {
  73   1              TMOD=0x01;
  74   1              TH0=(65536-50000)/256;
  75   1              TL0=(65536-50000)%256;
  76   1              EA=1;
  77   1              ET0=1;
  78   1              TR0=1;
  79   1      
  80   1              P0 = 0xff;
  81   1              if(flag0 == 0)
  82   1                  in();
  83   1              if(flag0 == 1)
  84   1                  xi();
  85   1              if(flag0 == 2)
  86   1                  pao();
  87   1              if(flag0 == 3)
  88   1                  xx();
  89   1              if(flag0 == 4)
  90   1                  out();
  91   1                      
  92   1      }
  93          
  94          //*******************************//
  95          //               结束子程序
  96          //*********************************//
  97          void over()
  98          {       other=0;
  99   1              anther=0;
 100   1              P0 = 0xff;
 101   1              mo_r=0;
 102   1              mo_l=0;
 103   1              led_over = 0;
 104   1              led_wring=0;
 105   1              EA=0;
 106   1      
 107   1      }
 108          
 109          //*********************************//
 110          //         进水子程序
 111          //*********************************//
 112          void in()
 113          {       anther=0;
 114   1              other=1;
 115   1              P0 = 0xff;
 116   1              led_in = 0;
 117   1              flag1++;
C51 COMPILER V8.05a   TEX                                                                  05/13/2013 19:21:38 PAGE 3   

 118   1              mo_r = 0;
 119   1              mo_l = 0  ;
 120   1              min = 0;
 121   1              sec = 5;
 122   1      }
 123          //*********************************//
 124          //              洗衣子程序
 125          //*********************************//
 126          void xi()
 127          {        anther=1;
 128   1               other=1;
 129   1           P0 = 0xff;
 130   1               led_work = 0;
 131   1               led_xi = 0;
 132   1               mo_r = 1;
 133   1               mo_l = 0;
 134   1               min = 0;
 135   1               sec = 30;
 136   1               quan = 0;
 137   1      }
 138          //*********************************//
 139          //         泡衣（漂洗）子程序
 140          //*********************************//
 141          void pao()
 142          {       
 143   1          anther=1;
 144   1              other=1;
 145   1              P0 = 0xff;
 146   1              led_pao = 0;
 147   1              led_work = 0;
 148   1              flag3++;
 149   1              mo_r = 1;
 150   1              mo_l = 0;
 151   1              min = 0;
 152   1              sec = 20;
 153   1              quan = 0;
 154   1      }
 155          //*********************************//
 156          //              脱水子程序
 157          //*********************************//
 158          void xx()
 159          {       other=0;
 160   1              anther=0;
 161   1              P0 = 0xff;
 162   1              led_xx = 0;
 163   1              led_out=0;
 164   1              mo_r = 0;
 165   1              mo_l = 1;
 166   1              min = 0;
 167   1              sec = 30;
 168   1      }
 169          //*********************************//
 170          //               出水子程序
 171          //*********************************//
 172          void out()
 173          {       anther=0;
 174   1              other=0;
 175   1              P0 = 0xff;
 176   1              led_out = 0;
 177   1              flag2++;
 178   1              mo_r = 0;
 179   1              mo_l = 0;
C51 COMPILER V8.05a   TEX                                                                  05/13/2013 19:21:38 PAGE 4   

 180   1              min = 0;
 181   1              sec = 5;
 182   1      }
 183          //*********************************//
 184          //         显示菜单选择
 185          //*********************************//
 186          void se()
 187          {
 188   1              P0 = 0xff;
 189   1              if(flag0 >= 5)
 190   1                      flag0 = 0; 
 191   1              if(flag0 == 0)
 192   1              {
 193   2                      led_in = 0;
 194   2              }
 195   1              if(flag0 == 1)
 196   1              {
 197   2                      led_xi=0;
 198   2              }
 199   1              if(flag0 == 2)
 200   1              {
 201   2                      led_pao=0;
 202   2              }
 203   1              if(flag0 == 3)
 204   1              {
 205   2                      led_xx=0;
 206   2              }
 207   1              if(flag0 == 4)
 208   1              {
 209   2                      led_out=0;
 210   2              }
 211   1      }
 212          //********************************//
 213          //         菜单处理子程序
 214          //**********************************//
 215          void menu()
 216          {       
 217   1          min = 0;
 218   1              sec = 0;
 219   1              mo_r=0;
 220   1              mo_l=0;
 221   1              SEG_display();
 222   1      
 223   1              while(1)
 224   1              {
 225   2                 if(key_on == 0)
 226   2                      {
 227   3                              delay(5);
 228   3                              if(key_on == 0)
 229   3                              {
 230   4                                      while(!key_on);
 231   4                                      on();
 232   4                                      break;
 233   4                              }
 234   3                      }
 235   2      //**************************//
 236   2                      if(key_off == 0)
 237   2                      {
 238   3                              delay(5);
 239   3                              if(key_off == 0)
 240   3                              {
 241   4                                      while(!key_off);
C51 COMPILER V8.05a   TEX                                                                  05/13/2013 19:21:38 PAGE 5   

 242   4                                      over();
 243   4                                      break;
 244   4                              }
 245   3                      }
 246   2      //****************************//
 247   2                      if(key_se == 0)
 248   2                      {
 249   3                              delay(5);
 250   3                              if(key_se == 0)
 251   3                              {
 252   4                                      while(!key_se);
 253   4                                      flag0++;
 254   4                                      se();
 255   4                              }
 256   3                      }                               
 257   2              }
 258   1      }
 259          //*********************************//
 260          //                 按键扫描子程序
 261          //*********************************//
 262          void key_scan()
 263          { 
 264   1              if(key_menu == 0)
 265   1              {
 266   2                      delay(5);
 267   2                      if(key_menu == 0)
 268   2                      {
 269   3                              while(!key_menu);
 270   3                              menu();
 271   3                      }
 272   2              }
 273   1      //********************************//
 274   1              if(key_on == 0)
 275   1              {
 276   2                      delay(5);
 277   2                      if(key_on == 0)
 278   2                      {
 279   3                              while(!key_on);
 280   3                              on();
 281   3                      }
 282   2              }
 283   1      //*********************************//
 284   1              if(key_off == 0)
 285   1              {
 286   2                      delay(5);
 287   2                      if(key_off == 0)
 288   2                      {
 289   3                              while(!key_off);
 290   3                              over();
 291   3                      }
 292   2              }
 293   1      }
 294          //*******************************//
 295          //      显示子程序
 296          //*********************************//
 297          void SEG_display()
 298          {
 299   1              P1=0x01;
 300   1              P2 = num[min/10];
 301   1              delay(10);
 302   1              P1 = 0x02;
 303   1              P2 = num[min%10];
C51 COMPILER V8.05a   TEX                                                                  05/13/2013 19:21:38 PAGE 6   

 304   1              delay(10);
 305   1              P1 = 0x04;
 306   1              P2 = num[sec/10];
 307   1              delay(10);
 308   1              P1 = 0x08;
 309   1              P2 = num[sec%10];
 310   1              delay(10);
 311   1      }
 312          //*********************************//
 313          //       主函数
 314          //*********************************//
 315          void main()
 316          {
 317   1              led_in=1;
 318   1              anther=0;
 319   1              other=0;
 320   1              while(1)
 321   1              {
 322   2                      
 323   2                      SEG_display();
 324   2                      key_scan();
 325   2              }
 326   1      }
 327          //**********************************//
 328          //          定时器0中断处理程序
 329          //**********************************//
 330          void timer0() interrupt 1
 331          {
 332   1              TH0=(65536-50000)/256;
 333   1              TL0=(65536-50000)%256;
 334   1              count++;
 335   1          if(count==20)
 336   1              {       
 337   2                      count = 0;
 338   2                      sec--;
 339   2                      if((flag0==1)||(flag0==2))
 340   2                      {
 341   3                          quan++;
 342   3                              switch(quan)
 343   3                               {
 344   4                                      case 1:mo_r=1;mo_l=0;break;       
 345   4                                      case 5:mo_r=0;mo_l=0;break;
 346   4                                      case 7:mo_r=0;mo_l=1;break;
 347   4                                      case 12:mo_r=0;mo_l=0;break;
 348   4                                  case 14:mo_r=1;mo_l=0;break;
 349   4                                      case 19:mo_r=0;mo_l=0;break;
 350   4                                      case 21:mo_r=0;mo_l=1;break;
 351   4                                  case 26:mo_r=0;mo_l=0;break;
 352   4                                      default:;
 353   4                               }
 354   3      
 355   3                              if(quan==30)
 356   3                              {
 357   4                                 quan=0;
 358   4                              }
 359   3      
 360   3                      }
 361   2               //**********************************//
 362   2                      if((sec == 0)&&(min != 0))
 363   2                      {
 364   3                        min--;
 365   3                        sec = 59;
C51 COMPILER V8.05a   TEX                                                                  05/13/2013 19:21:38 PAGE 7   

 366   3                       }
 367   2                //**********************************//
 368   2                      if((sec<0)&&(min==0)&&(flag0==0))        //进水结束
 369   2                      {        
 370   3                           switch(flag1)
 371   3                               {
 372   4                                      case 1:flag0=1;xi();break;
 373   4                                      case 2:flag0=2;pao();break;
 374   4                                      case 3:flag0=2;pao();break;
 375   4                                      case 4:flag0=2;pao();break;
 376   4                                      default: err=1;led_wring = 0;
 377   4                               }
 378   3                      }
 379   2               //**********************************//
 380   2                      if((sec<0)&&(min==0)&&(flag0==1))   //洗衣结束
 381   2                      {        
 382   3                           flag0 = 4;
 383   3                               out();
 384   3                      }
 385   2               //**********************************//
 386   2                      if((sec<0)&&(min==0)&&(flag0==2))   //泡衣结束
 387   2                      {        
 388   3                           switch(flag3)
 389   3                               {
 390   4                                      case 1:flag0=4;out();break;
 391   4                                      case 2:flag0=4;out();break;
 392   4                                      case 3:flag0=4;out();break;
 393   4                                      default: err=1;led_wring = 0;
 394   4                               }
 395   3                      }
 396   2               //**********************************//
 397   2                      if((sec<0)&&(min==0)&&(flag0==4))        //出水结束
 398   2                      {       
 399   3                              switch(flag2)
 400   3                               {
 401   4                                      case 1:flag0=0;in();break;
 402   4                                      case 2:flag0=0;in();break;
 403   4                                      case 3:flag0=0;in();break;
 404   4                                      case 4:flag0=3;xx();break;
 405   4      
 406   4                                      default: err= 1;led_wring = 0;
 407   4                               }
 408   3                      }
 409   2               //***********************************//
 410   2                      if((sec<0)&&(min==0)&&(flag0==3))
 411   2                      {        sec = 0;
 412   3                               over();
 413   3                      }
 414   2      
 415   2              }
 416   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    851    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V8.05a   TEX                                                                  05/13/2013 19:21:38 PAGE 8   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
